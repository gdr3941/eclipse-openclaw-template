# OpenClaw App Platform Template (Eclipse Partners)
# 
# Security features:
# - All secrets marked as SECRET type (encrypted at rest)
# - Unique gateway token per instance
# - Explicit loopback bind (no network exposure)
# - Exec security in allowlist mode
# - Sensitive data redaction in logs
# - Telegram DM restricted to single user
#
# Included skills (in workspace):
# - flight-tracker (live tracking, no API key needed)
# - o365-calendar (requires Azure AD setup)
# - sec-filing-watcher (SEC EDGAR alerts)
# - arxiv-watcher (research paper search)
#
# Bundled skills (no setup):
# - weather
# - clawhub
#
# Usage:
#   1. Copy this file: cp openclaw-appplatform.yaml openclaw-<name>.yaml
#   2. Replace all PARTNER_* placeholders
#   3. Generate gateway token: openssl rand -hex 32
#   4. Deploy: doctl apps create --spec openclaw-<name>.yaml

name: openclaw-PARTNER_NAME
region: nyc

services:
  - name: openclaw
    image:
      registry_type: DOCKER_HUB
      registry: openclaw
      repository: openclaw
      tag: latest
    instance_count: 1
    instance_size_slug: basic-xxs  # $5/mo - upgrade to basic-xs ($12) if needed
    
    # Auto-initialize workspace on first boot
    run_command: |
      sh -c '
        if [ ! -f /mnt/workspace/SOUL.md ]; then
          echo "Initializing workspace from template..."
          cd /mnt/workspace
          wget -qO- https://github.com/gdr3941/eclipse-openclaw-template/archive/refs/heads/main.tar.gz | tar xz --strip-components=1
          echo "Workspace initialized."
        fi
        exec openclaw gateway start --foreground
      '
    
    envs:
      # ═══════════════════════════════════════════════════
      # REQUIRED: Partner Credentials
      # ═══════════════════════════════════════════════════
      - key: ANTHROPIC_API_KEY
        value: "PARTNER_ANTHROPIC_KEY"
        type: SECRET
      - key: TELEGRAM_BOT_TOKEN
        value: "PARTNER_BOT_TOKEN"
        type: SECRET
      - key: TELEGRAM_ALLOWED_USERS
        value: "PARTNER_TELEGRAM_ID"
      
      # ═══════════════════════════════════════════════════
      # SECURITY: Gateway Protection
      # ═══════════════════════════════════════════════════
      - key: OPENCLAW_GATEWAY_TOKEN
        value: "PARTNER_GATEWAY_TOKEN"
        type: SECRET
      - key: OPENCLAW_GATEWAY_BIND
        value: "loopback"
      
      # ═══════════════════════════════════════════════════
      # SECURITY: Exec & Logging
      # ═══════════════════════════════════════════════════
      - key: OPENCLAW_EXEC_SECURITY
        value: "allowlist"
      - key: OPENCLAW_LOG_REDACT_SENSITIVE
        value: "tools"
      
      # ═══════════════════════════════════════════════════
      # AGENT: Model & Behavior
      # ═══════════════════════════════════════════════════
      - key: OPENCLAW_MODEL
        value: "anthropic/claude-sonnet-4"
      - key: TZ
        value: "PARTNER_TIMEZONE"
      - key: OPENCLAW_WORKSPACE
        value: "/mnt/workspace"
      
      # ═══════════════════════════════════════════════════
      # O365 Calendar Integration
      # ═══════════════════════════════════════════════════
      # Azure AD app registration required
      # See skills/o365-calendar/SKILL.md for setup
      - key: O365_CLIENT_ID
        value: "PARTNER_O365_CLIENT_ID"
      - key: O365_TENANT_ID
        value: "PARTNER_O365_TENANT_ID"

    # Persistent storage for workspace files
    volumes:
      - name: workspace
        path: /mnt/workspace
        size_gib: 1

# Volume definition
volumes:
  - name: workspace
    size_gib: 1
